!cmd install kiss2.js const axios = require("axios");
const fs = require("fs-extra");
const path = require("path");
const jimp = require("jimp");

module.exports = {
  config: {
    name: "kiss2",
    version: "2.0.1",
    author: "Mamun",
    countDown: 5,
    role: 0,
    shortDescription: {
      en: "Kiss image"
    },
    longDescription: {
      en: "Send kiss image with tagged person"
    },
    category: "love",
    guide: {
      en: "{pn} @tag"
    }
  },

  onLoad: async function () {
    const dirMaterial = __dirname + `/cache/`;
    const imgPath = path.resolve(__dirname, "cache", "hon.png");

    if (!fs.existsSync(dirMaterial)) fs.mkdirSync(dirMaterial, { recursive: true });

    if (!fs.existsSync(imgPath)) {
      const img = (await axios.get("https://i.imgur.com/BtSlsSS.jpg", { responseType: "arraybuffer" })).data;
      fs.writeFileSync(imgPath, Buffer.from(img));
    }
  },

  onStart: async function ({ message, event }) {
    const { senderID, mentions } = event;
    const mentionID = Object.keys(mentions)[0];

    if (!mentionID) return message.reply("âŒ | Please tag 1 person");

    const captions = [
      "à¦•à¦¾à¦°à¦£à§‡ à¦…à¦•à¦¾à¦°à¦£à§‡ à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¿à¦¨ à¦¨à¦¿à¦¯à¦¼à¦® à¦•à¦°à§‡, à¦¤à§‹à¦®à¦¾à¦° à¦®à¦¾à¦¯à¦¼à¦¾à¦¤à§‡ à¦œà¦¡à¦¼à¦¿à¦¯à¦¼à§‡ à¦ªà¦¡à¦¼à¦›à¦¿ à¦†à¦®à¦¿ à¦¬à¦¾à¦°à§‡à¦¬à¦¾à¦°!ðŸŒ·",
      "à¦¤à§‹à¦®à¦¾à¦•à§‡ à¦•à§‡à¦¨ à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¿ à¦¤à¦¾à¦° à¦•à§‹à¦¨ à¦¬à¦¿à¦¶à§‡à¦· à¦•à¦¾à¦°à¦£ à¦†à¦®à¦¾à¦° à¦œà¦¾à¦¨à¦¾ à¦¨à¦¾à¦‡! à¦•à¦¿à¦¨à§à¦¤à§ à¦¤à§‹à¦®à¦¾à¦° à¦•à¦¾à¦›à§‡ à¦¸à¦¾à¦°à¦¾à¦œà§€à¦¬à¦¨ à¦¥à§‡à¦•à§‡ à¦¯à¦¾à¦“à¦¯à¦¼à¦¾à¦° à¦¹à¦¾à¦œà¦¾à¦°à¦Ÿà¦¾ à¦•à¦¾à¦°à¦£ à¦†à¦®à¦¾à¦° à¦•à¦¾à¦›à§‡ à¦†à¦›à§‡!ðŸ’š",
      "à¦¤à§‹à¦®à¦¾à¦° à¦¸à¦¾à¦¥à§‡ à¦•à¦¾à¦Ÿà¦¾à¦¨à§‹ à¦¸à¦®à¦¯à¦¼à¦—à§à¦²à§‹à¦° à¦•à¦¥à¦¾ à¦šà¦¿à¦¨à§à¦¤à¦¾ à¦•à¦°à¦²à§‡ à¦®à¦¨à§‡ à¦¹à¦¯à¦¼, à¦à¦‡ à¦à¦• à¦œà¦¨à¦® à¦¤à§‹à¦®à¦¾à¦° à¦¸à¦¾à¦¥à§‡ à¦…à¦¨à§‡à¦• à¦•à¦® à¦¸à¦®à¦¯à¦¼!ðŸ˜˜",
      "à¦ªà§à¦°à¦¿à¦¯à¦¼ à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦†à¦®à¦¾à¦° à¦œà§€à¦¬à¦¨à§‡à¦° à¦¸à§‡à¦‡ à¦—à¦²à§à¦ª à¦¹à¦¬à§‡? à¦¯à§‡à¦‡ à¦—à¦²à§à¦ªà§‡à¦° à¦¶à§à¦°à§ à¦¥à¦¾à¦•à¦¬à§‡, à¦•à¦¿à¦¨à§à¦¤à§ à¦•à§‹à¦¨à§‹ à¦¶à§‡à¦· à¦¥à¦¾à¦•à¦¬à§‡ à¦¨à¦¾!â™¥ï¸",
      "à¦¤à§à¦®à¦¿ à¦ªà¦¾à¦¶à§‡ à¦¥à¦¾à¦•à¦²à§‡ à¦¸à¦¬à¦•à¦¿à¦›à§ à¦¸à§à¦¨à§à¦¦à¦° à¦®à¦¨à§‡ à¦¹à§Ÿ, à¦œà§€à¦¬à¦¨ à¦¯à§‡à¦¨ à¦à¦•à¦Ÿà¦¾ à¦®à¦§à§à¦° à¦•à¦¬à¦¿à¦¤à¦¾à§Ÿ à¦°à§‚à¦ª à¦¨à§‡à§Ÿ!ðŸ˜"
    ];

    const randomCaption = captions[Math.floor(Math.random() * captions.length)];

    // ðŸ“ Paths
    const root = path.resolve(__dirname, "cache");
    const frame = await jimp.read(root + "/hon.png");

    const avt1 = root + `/avt_${senderID}.png`;
    const avt2 = root + `/avt_${mentionID}.png`;
    const out = root + `/kiss_${senderID}_${mentionID}.png`;

    // ðŸ–¼ Download avatars
    const img1 = (await axios.get(`https://graph.facebook.com/${senderID}/picture?width=512&height=512`, { responseType: "arraybuffer" })).data;
    const img2 = (await axios.get(`https://graph.facebook.com/${mentionID}/picture?width=512&height=512`, { responseType: "arraybuffer" })).data;

    fs.writeFileSync(avt1, Buffer.from(img1));
    fs.writeFileSync(avt2, Buffer.from(img2));

    // ðŸ”µ Circle avatars
    const circle = async (imgPath) => {
      const img = await jimp.read(imgPath);
      img.circle();
      return img;
    };

    const c1 = await circle(avt1);
    const c2 = await circle(avt2);

    // ðŸ§© Composite
    frame
      .resize(700, 440)
      .composite(c1.resize(200, 200), 390, 23)
      .composite(c2.resize(180, 180), 140, 80);

    await frame.writeAsync(out);

    // ðŸ“¤ Send
    await message.reply({
      body: randomCaption,
      attachment: fs.createReadStream(out)
    });

    // ðŸ§¹ Clean
    fs.unlinkSync(avt1);
    fs.unlinkSync(avt2);
    fs.unlinkSync(out);
  }
};
