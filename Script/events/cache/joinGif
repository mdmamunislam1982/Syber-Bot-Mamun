const axios = require("axios");
const fs = require("fs");
const path = require("path");

module.exports.config = {
  name: "islamicwelcome",
  eventType: ["log:subscribe"],
  version: "1.0.1",
  credits: "Mamun",
  description: "Islamic welcome with image"
};

module.exports.run = async ({ api, event }) => {
  const threadID = event.threadID;

  if (!event.logMessageData || !event.logMessageData.addedParticipants) return;

  const addedUsers = event.logMessageData.addedParticipants;

  for (const user of addedUsers) {
    try {
      const userName = user.fullName || "New Member";
      const userID = user.userFbId || user.userID;

      const imgUrl = "https://i.imgur.com/8QZQZQp.jpg";
      const imgPath = path.join(__dirname, `${userID}_join.jpg`);

      const img = await axios.get(imgUrl, { responseType: "arraybuffer" });
      fs.writeFileSync(imgPath, img.data);

      const message =
`ðŸŒ™âœ¨ à¦‡à¦¸à¦²à¦¾à¦®à§€ à¦¶à§à¦­à§‡à¦šà§à¦›à¦¾ âœ¨ðŸŒ™

ðŸ¤ à¦†à¦¸à¦¸à¦¾à¦²à¦¾à¦®à§ à¦†à¦²à¦¾à¦‡à¦•à§à¦®
ðŸ‘¤ ${userName}

ðŸ“¿ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦à¦‡ à¦—à§à¦°à§à¦ªà§‡ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦¸à§à¦¬à¦¾à¦—à¦¤à¦®
ðŸ¤² à¦†à¦²à§à¦²à¦¾à¦¹ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦‰à¦¤à§à¦¤à¦® à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¾à¦¨ à¦¦à¦¾à¦¨ à¦•à¦°à§à¦¨

ðŸ“– â€œà¦¤à§‹à¦®à¦°à¦¾ à¦¸à¦¾à¦²à¦¾à¦® à¦ªà§à¦°à¦šà¦¾à¦° à¦•à¦°à§‹â€ (à¦¹à¦¾à¦¦à¦¿à¦¸)

ðŸ•Œ à¦—à§à¦°à§à¦ªà§‡à¦° à¦¨à¦¿à§Ÿà¦® à¦®à§‡à¦¨à§‡ à¦šà¦²à¦¬à§‡à¦¨
ðŸ¤ à¦¸à¦¬à¦¾à¦‡à¦•à§‡ à¦¸à¦®à§à¦®à¦¾à¦¨ à¦•à¦°à¦¬à§‡à¦¨

â€” Islamic Bot ðŸ¤–`;

      api.sendMessage(
        {
          body: message,
          attachment: fs.createReadStream(imgPath),
          mentions: [{ tag: userName, id: userID }]
        },
        threadID,
        () => fs.unlinkSync(imgPath)
      );

    } catch (e) {
      console.log("Welcome Error:", e);
    }
  }
};
