const axios = require("axios");
const fs = require("fs");
const path = require("path");

module.exports.config = {
  name: "islamicwelcome",
  eventType: ["log:subscribe"],
  version: "1.0.0",
  credits: "RAHAT",
  description: "Islamic welcome with image"
};

module.exports.run = async ({ api, event }) => {
  const threadID = event.threadID;

  try {
    const addedUsers = event.logMessageData.addedParticipants;

    for (const user of addedUsers) {
      const userName = user.fullName || "New Member";
      const userID = user.userFbId;

      // ðŸ–¼ï¸ Islamic Welcome Image (change link if you want)
      const imgUrl =
        "https://i.imgur.com/8QZQZQp.jpg"; // Islamic welcome image

      const imgPath = path.join(__dirname, "welcome.jpg");
      const img = (await axios.get(imgUrl, { responseType: "arraybuffer" })).data;
      fs.writeFileSync(imgPath, Buffer.from(img));

      const message =
`ðŸŒ™âœ¨ à¦‡à¦¸à¦²à¦¾à¦®à§€ à¦¶à§à¦­à§‡à¦šà§à¦›à¦¾ âœ¨ðŸŒ™

ðŸ¤ à¦†à¦¸à¦¸à¦¾à¦²à¦¾à¦®à§ à¦†à¦²à¦¾à¦‡à¦•à§à¦®
ðŸ‘¤ ${userName}

ðŸ“¿ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦à¦‡ à¦—à§à¦°à§à¦ªà§‡ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦¸à§à¦¬à¦¾à¦—à¦¤à¦®
ðŸ¤² à¦†à¦²à§à¦²à¦¾à¦¹ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦‰à¦¤à§à¦¤à¦® à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¾à¦¨ à¦¦à¦¾à¦¨ à¦•à¦°à§à¦¨

ðŸ“– â€œà¦¯à§‡ à¦¬à§à¦¯à¦•à§à¦¤à¦¿ à¦¸à¦¾à¦²à¦¾à¦® à¦ªà§à¦°à¦šà¦¾à¦° à¦•à¦°à¦¬à§‡,
à¦¸à§‡ à¦œà¦¾à¦¨à§à¦¨à¦¾à¦¤à§‡ à¦ªà§à¦°à¦¬à§‡à¦¶ à¦•à¦°à¦¬à§‡â€ (à¦¹à¦¾à¦¦à¦¿à¦¸)

ðŸ•Œ à¦—à§à¦°à§à¦ªà§‡à¦° à¦¨à¦¿à§Ÿà¦® à¦®à§‡à¦¨à§‡ à¦šà¦²à¦¬à§‡à¦¨
ðŸ¤ à¦¸à¦¬à¦¾à¦‡à¦•à§‡ à¦¸à¦®à§à¦®à¦¾à¦¨ à¦•à¦°à¦¬à§‡à¦¨

â€” Islamic Bot ðŸ¤–`;

      api.sendMessage(
        {
          body: message,
          attachment: fs.createReadStream(imgPath),
          mentions: [
            {
              tag: userName,
              id: userID
            }
          ]
        },
        threadID,
        () => fs.unlinkSync(imgPath)
      );
    }
  } catch (err) {
    console.log("Islamic Welcome Error:", err);
  }
};
